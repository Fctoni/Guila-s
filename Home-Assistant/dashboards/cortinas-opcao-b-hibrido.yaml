# Dashboard Cortinas - OPCAO B: Layout Customizado
# Projeto Guilas - Casa Le Parc
# Atualizado: 2026-01-24
#
# Dependencias HACS:
#   - custom:button-card
#   - lovelace-mushroom
#
# Layout:
#   - Linha 1: Visualizacao (paineis + info)
#   - Linha 2: Slider (largura total)
#   - Linha 3: Botoes
#
# Conversao Visual:
#   - ESPHome 100% = Visual 80% (cortinas centro-abertura com acumulo de tecido)
#   - Ver: Documentacao/03-Arquitetura/circuitos/cortinas-terreo.md

button_card_templates:
  # Cabecalho da pagina
  label_header:
    color_type: label-card
    styles:
      card:
        - background: none
        - font-size: 20px
        - font-weight: bold
        - padding: 16px 0 8px 0
        - border: none
        - box-shadow: none

  # Card principal da cortina com visualizacao
  cover_visual:
    show_state: false
    show_icon: false
    show_name: true
    tap_action:
      action: more-info
    styles:
      card:
        - border-radius: 12px 12px 0 0
        - padding: 16px
        - background: var(--card-background-color)
      grid:
        - grid-template-areas: '"n" "visual" "info"'
        - grid-template-rows: min-content 1fr min-content
      name:
        - font-weight: bold
        - font-size: 16px
        - justify-self: start
        - padding-bottom: 12px
      custom_fields:
        visual:
          - padding: 8px 0
        info:
          - padding-top: 8px
    custom_fields:
      visual: |
        [[[
          const pos = entity.attributes.current_position ?? 0;
          const visualPos = pos * 0.8;  // Conversao: 100% ESPHome = 80% visual
          const panelWidth = 50 - (visualPos / 2);
          const gapWidth = visualPos;
          const panelColor = 'var(--primary-color)';
          const bgColor = 'var(--primary-background-color)';

          return `
            <div style="
              display: flex;
              justify-content: center;
              align-items: center;
              height: 60px;
              background: ${bgColor};
              border-radius: 8px;
              overflow: hidden;
              position: relative;
            ">
              <!-- Trilho -->
              <div style="
                position: absolute;
                top: 8px;
                left: 10%;
                right: 10%;
                height: 4px;
                background: var(--divider-color);
                border-radius: 2px;
              "></div>

              <!-- Painel esquerdo -->
              <div style="
                width: ${panelWidth}%;
                height: 50px;
                background: linear-gradient(90deg, ${panelColor} 0%, ${panelColor}dd 100%);
                border-radius: 4px 0 0 4px;
                transition: width 0.3s ease;
                box-shadow: 2px 0 4px rgba(0,0,0,0.2);
              "></div>

              <!-- Espaco central (janela) -->
              <div style="
                width: ${gapWidth}%;
                height: 50px;
                background: linear-gradient(180deg, #87CEEB 0%, #E0F6FF 100%);
                transition: width 0.3s ease;
              "></div>

              <!-- Painel direito -->
              <div style="
                width: ${panelWidth}%;
                height: 50px;
                background: linear-gradient(270deg, ${panelColor} 0%, ${panelColor}dd 100%);
                border-radius: 0 4px 4px 0;
                transition: width 0.3s ease;
                box-shadow: -2px 0 4px rgba(0,0,0,0.2);
              "></div>
            </div>
          `;
        ]]]
      info: |
        [[[
          const pos = entity.attributes.current_position ?? 0;
          const visualPos = Math.round(pos * 0.8);  // Conversao: 100% ESPHome = 80% visual
          const state = entity.state;
          let statusText = '';
          let statusColor = 'var(--secondary-text-color)';

          if (state === 'opening') {
            statusText = 'Abrindo...';
            statusColor = 'var(--state-cover-open-color, #44739e)';
          } else if (state === 'closing') {
            statusText = 'Fechando...';
            statusColor = 'var(--state-cover-closed-color, #9da0a2)';
          } else if (pos >= 100) {
            statusText = 'Aberta';
          } else if (pos <= 0) {
            statusText = 'Fechada';
          } else {
            statusText = visualPos + '% aberta';
          }

          return `
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span style="font-size: 13px; color: ${statusColor};">${statusText}</span>
              <span style="font-size: 13px; color: var(--secondary-text-color);">${visualPos}%</span>
            </div>
          `;
        ]]]

  # Botao de acao individual
  btn_cover:
    show_icon: true
    show_name: true
    layout: icon_name
    size: 28px
    styles:
      card:
        - border-radius: 0 0 12px 12px
        - padding: 12px
        - background: var(--primary-background-color)
      icon:
        - color: var(--primary-color)
      name:
        - font-size: 14px
        - font-weight: bold

title: Cortinas (Hibrido)
views:
  - title: Cortinas
    path: cortinas-hibrido
    icon: mdi:blinds-horizontal
    cards:
      # Cabecalho
      - type: custom:button-card
        template: label_header
        name: Cortinas do Terreo

      # ==================== CORTINA ESTAR ====================
      - type: vertical-stack
        cards:
          # Linha 1: Icone + Nome + Estado
          - type: custom:button-card
            template: cover_visual
            entity: cover.cortinas_terreo_cortina_estar
            name: Estar

          # Linha 2: Slider (largura total)
          - type: custom:mushroom-cover-card
            entity: cover.cortinas_terreo_cortina_estar
            show_name: false
            show_icon: false
            show_position_control: true
            show_buttons_control: false

          # Linha 3: Botoes
          - type: horizontal-stack
            cards:
              - type: custom:button-card
                template: btn_cover
                icon: mdi:arrow-expand-horizontal
                name: Abrir
                tap_action:
                  action: call-service
                  service: cover.open_cover
                  service_data:
                    entity_id: cover.cortinas_terreo_cortina_estar

              - type: custom:button-card
                template: btn_cover
                icon: mdi:stop
                name: Parar
                tap_action:
                  action: call-service
                  service: cover.stop_cover
                  service_data:
                    entity_id: cover.cortinas_terreo_cortina_estar

              - type: custom:button-card
                template: btn_cover
                icon: mdi:arrow-collapse-horizontal
                name: Fechar
                tap_action:
                  action: call-service
                  service: cover.close_cover
                  service_data:
                    entity_id: cover.cortinas_terreo_cortina_estar

      # ==================== CORTINA JANTAR ====================
      - type: vertical-stack
        cards:
          - type: custom:button-card
            template: cover_visual
            entity: cover.cortinas_terreo_cortina_jantar
            name: Jantar

          - type: custom:mushroom-cover-card
            entity: cover.cortinas_terreo_cortina_jantar
            show_name: false
            show_icon: false
            show_position_control: true
            show_buttons_control: false

          - type: horizontal-stack
            cards:
              - type: custom:button-card
                template: btn_cover
                icon: mdi:arrow-expand-horizontal
                name: Abrir
                tap_action:
                  action: call-service
                  service: cover.open_cover
                  service_data:
                    entity_id: cover.cortinas_terreo_cortina_jantar

              - type: custom:button-card
                template: btn_cover
                icon: mdi:stop
                name: Parar
                tap_action:
                  action: call-service
                  service: cover.stop_cover
                  service_data:
                    entity_id: cover.cortinas_terreo_cortina_jantar

              - type: custom:button-card
                template: btn_cover
                icon: mdi:arrow-collapse-horizontal
                name: Fechar
                tap_action:
                  action: call-service
                  service: cover.close_cover
                  service_data:
                    entity_id: cover.cortinas_terreo_cortina_jantar

      # ==================== CORTINA OFFICE ====================
      - type: vertical-stack
        cards:
          - type: custom:button-card
            template: cover_visual
            entity: cover.cortinas_terreo_cortina_office
            name: Office

          - type: custom:mushroom-cover-card
            entity: cover.cortinas_terreo_cortina_office
            show_name: false
            show_icon: false
            show_position_control: true
            show_buttons_control: false

          - type: horizontal-stack
            cards:
              - type: custom:button-card
                template: btn_cover
                icon: mdi:arrow-expand-horizontal
                name: Abrir
                tap_action:
                  action: call-service
                  service: cover.open_cover
                  service_data:
                    entity_id: cover.cortinas_terreo_cortina_office

              - type: custom:button-card
                template: btn_cover
                icon: mdi:stop
                name: Parar
                tap_action:
                  action: call-service
                  service: cover.stop_cover
                  service_data:
                    entity_id: cover.cortinas_terreo_cortina_office

              - type: custom:button-card
                template: btn_cover
                icon: mdi:arrow-collapse-horizontal
                name: Fechar
                tap_action:
                  action: call-service
                  service: cover.close_cover
                  service_data:
                    entity_id: cover.cortinas_terreo_cortina_office

      # ==================== CORTINA RESERVA ====================
      - type: vertical-stack
        cards:
          - type: custom:button-card
            template: cover_visual
            entity: cover.cortinas_terreo_cortina_reserva
            name: Reserva

          - type: custom:mushroom-cover-card
            entity: cover.cortinas_terreo_cortina_reserva
            show_name: false
            show_icon: false
            show_position_control: true
            show_buttons_control: false

          - type: horizontal-stack
            cards:
              - type: custom:button-card
                template: btn_cover
                icon: mdi:arrow-expand-horizontal
                name: Abrir
                tap_action:
                  action: call-service
                  service: cover.open_cover
                  service_data:
                    entity_id: cover.cortinas_terreo_cortina_reserva

              - type: custom:button-card
                template: btn_cover
                icon: mdi:stop
                name: Parar
                tap_action:
                  action: call-service
                  service: cover.stop_cover
                  service_data:
                    entity_id: cover.cortinas_terreo_cortina_reserva

              - type: custom:button-card
                template: btn_cover
                icon: mdi:arrow-collapse-horizontal
                name: Fechar
                tap_action:
                  action: call-service
                  service: cover.close_cover
                  service_data:
                    entity_id: cover.cortinas_terreo_cortina_reserva

      # ==================== CONTROLE GERAL ====================
      - type: custom:button-card
        template: label_header
        name: Controle Geral

      - type: horizontal-stack
        cards:
          - type: custom:button-card
            template: btn_cover
            icon: mdi:arrow-expand-horizontal
            name: Abrir Todas
            tap_action:
              action: call-service
              service: cover.open_cover
              service_data:
                entity_id:
                  - cover.cortinas_terreo_cortina_estar
                  - cover.cortinas_terreo_cortina_jantar
                  - cover.cortinas_terreo_cortina_office
                  - cover.cortinas_terreo_cortina_reserva
            styles:
              card:
                - border-radius: 16px

          - type: custom:button-card
            template: btn_cover
            icon: mdi:stop
            name: Parar Todas
            tap_action:
              action: call-service
              service: cover.stop_cover
              service_data:
                entity_id:
                  - cover.cortinas_terreo_cortina_estar
                  - cover.cortinas_terreo_cortina_jantar
                  - cover.cortinas_terreo_cortina_office
                  - cover.cortinas_terreo_cortina_reserva
            styles:
              card:
                - border-radius: 16px

          - type: custom:button-card
            template: btn_cover
            icon: mdi:arrow-collapse-horizontal
            name: Fechar Todas
            tap_action:
              action: call-service
              service: cover.close_cover
              service_data:
                entity_id:
                  - cover.cortinas_terreo_cortina_estar
                  - cover.cortinas_terreo_cortina_jantar
                  - cover.cortinas_terreo_cortina_office
                  - cover.cortinas_terreo_cortina_reserva
            styles:
              card:
                - border-radius: 16px
